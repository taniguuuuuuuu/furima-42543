// request@2.30.0 downloaded from https://ga.jspm.io/npm:request@2.30.0/index.js

import e from"http";import t from"url";import r from"util";import o from"stream";import s from"qs";import i from"querystring";import a from"crypto";import n from"node-uuid";import u from"mime";import h from"json-stringify-safe";import p from"forever-agent";import c from"process";import l from"buffer";var f={};function _nullRequire(e){var t=new Error("Cannot find module '"+e+"'");t.code="MODULE_NOT_FOUND";throw t}f=function(e){try{return _nullRequire(e)}catch(e){}};var m=f;var y={};y=function copy(e){var t={};Object.keys(e).forEach((function(r){t[r]=e[r]}));return t};var g=y;var v={};var b=c;var q=r;v=function debug(){/\brequest\b/.test(b.env.NODE_DEBUG)&&console.error("REQUEST %s",q.format.apply(q,arguments))};var _=v;var w={};w=function getSafe(e,t){if("object"===typeof e||"function"===typeof e)var r={};if(Array.isArray(e))var r=[];var o=[];Object.defineProperty(e,t,{});var s=Object.keys(e).filter((function(r){return r!==t&&("object"!==typeof e[r]&&"function"!==typeof e[r]||null===e[r]||!Object.getOwnPropertyDescriptor(e[r],t))}));for(var i=0;i<s.length;i++)if("object"!==typeof e[s[i]]&&"function"!==typeof e[s[i]]||null===e[s[i]])r[s[i]]=e[s[i]];else{o.push(s[i]);Object.defineProperty(e[s[i]],t,{})}for(var i=0;i<o.length;i++)r[o[i]]=getSafe(e[o[i]],t);return r};var H=w;var k="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var E={};var R=l.Buffer;var S=c;var j=m,x=e,A=j("https"),O=j("tls"),T=t,C=r,z=o,P=s,U=i,D=a,M=j("oauth-sign"),N=j("hawk"),B=j("aws-sign"),L=j("http-signature"),I=n,F=u,J=j("tunnel-agent"),G=h,Y=p,K=j("form-data"),Q=j("tough-cookie"),$=Q&&Q.CookieJar,V=$&&new $,W=g,X=_,Z=H;function safeStringify(e){var t;try{t=JSON.stringify(e)}catch(r){t=G(e)}return t}var ee={};var te=/^https?:/i;if(A&&!A.Agent){A.Agent=function(e){x.Agent.call(this||k,e)};C.inherits(A.Agent,x.Agent);A.Agent.prototype._getConnection=function(e,t,r){var o=O.connect(t,e,(this||k).options,(function(){r&&r()}));return o}}function isReadStream(e){if(e.readable&&e.path&&e.mode)return true}function toBase64(e){return new R(e||"","ascii").toString("base64")}function md5(e){return D.createHash("md5").update(e).digest("hex")}function Request(e){z.Stream.call(this||k);(this||k).readable=true;(this||k).writable=true;"string"===typeof e&&(e={uri:e});var t=Object.keys(Request.prototype);for(var r in e)-1===t.indexOf(r)?(this||k)[r]=e[r]:"function"===typeof e[r]&&delete e[r];e.method&&((this||k).explicitMethod=true);(this||k).canTunnel=false!==e.tunnel&&J;this.init(e)}C.inherits(Request,z.Stream);Request.prototype.init=function(e){var t=this||k;e||(e={});t.method||(t.method=e.method||"GET");t.localAddress=e.localAddress;X(e);t.pool||false===t.pool||(t.pool=ee);t.dests=t.dests||[];t.__isRequestRequest=true;if(!t._callback&&t.callback){t._callback=t.callback;t.callback=function(){if(!t._callbackCalled){t._callbackCalled=true;t._callback.apply(t,arguments)}};t.on("error",t.callback.bind());t.on("complete",t.callback.bind(t,null))}if(t.url&&!t.uri){t.uri=t.url;delete t.url}if(!t.uri)return t.emit("error",new Error("options.uri is a required argument"));"string"==typeof t.uri&&(t.uri=T.parse(t.uri));false===t.strictSSL&&(t.rejectUnauthorized=false);if(t.proxy){"string"==typeof t.proxy&&(t.proxy=T.parse(t.proxy));if(x.globalAgent&&"https:"===t.uri.protocol&&t.canTunnel){var r="http:"===t.proxy.protocol?J.httpsOverHttp:J.httpsOverHttps;var o={proxy:{host:t.proxy.hostname,port:+t.proxy.port,proxyAuth:t.proxy.auth,headers:{Host:t.uri.hostname+":"+(t.uri.port||"https:"===t.uri.protocol?443:80)}},rejectUnauthorized:t.rejectUnauthorized,ca:(this||k).ca};t.agent=r(o);t.tunnel=true}}t.uri.pathname||(t.uri.pathname="/");if(t.uri.host){t._redirectsFollowed=t._redirectsFollowed||0;t.maxRedirects=void 0!==t.maxRedirects?t.maxRedirects:10;t.followRedirect=void 0===t.followRedirect||t.followRedirect;t.followAllRedirects=void 0!==t.followAllRedirects&&t.followAllRedirects;(t.followRedirect||t.followAllRedirects)&&(t.redirects=t.redirects||[]);t.headers=t.headers?W(t.headers):{};t.setHost=false;if(!t.hasHeader("host")){t.setHeader("host",t.uri.hostname);t.uri.port&&(80===t.uri.port&&"http:"===t.uri.protocol||443===t.uri.port&&"https:"===t.uri.protocol||t.setHeader("host",t.getHeader("host")+":"+t.uri.port));t.setHost=true}t.jar(t._jar||e.jar);t.uri.port||("http:"==t.uri.protocol?t.uri.port=80:"https:"==t.uri.protocol&&(t.uri.port=443));if(t.proxy&&!t.tunnel){t.port=t.proxy.port;t.host=t.proxy.hostname}else{t.port=t.uri.port;t.host=t.uri.hostname}t.clientErrorHandler=function(e){if(!t._aborted)if(t.req&&t.req._reusedSocket&&"ECONNRESET"===e.code&&t.agent.addRequestNoreuse){t.agent={addRequest:t.agent.addRequestNoreuse.bind(t.agent)};t.start();t.req.end()}else{if(t.timeout&&t.timeoutTimer){clearTimeout(t.timeoutTimer);t.timeoutTimer=null}t.emit("error",e)}};t._parserErrorHandler=function(e){(this||k).res?(this||k).res.request?(this||k).res.request.emit("error",e):(this||k).res.emit("error",e):(this||k)._httpMessage.emit("error",e)};e.form&&t.form(e.form);e.qs&&t.qs(e.qs);t.uri.path?t.path=t.uri.path:t.path=t.uri.pathname+(t.uri.search||"");0===t.path.length&&(t.path="/");e.oauth&&t.oauth(e.oauth);e.aws&&t.aws(e.aws);e.hawk&&t.hawk(e.hawk);e.httpSignature&&t.httpSignature(e.httpSignature);if(e.auth){Object.prototype.hasOwnProperty.call(e.auth,"username")&&(e.auth.user=e.auth.username);Object.prototype.hasOwnProperty.call(e.auth,"password")&&(e.auth.pass=e.auth.password);t.auth(e.auth.user,e.auth.pass,e.auth.sendImmediately)}if(t.uri.auth&&!t.hasHeader("authorization")){var s=t.uri.auth.split(":").map((function(e){return U.unescape(e)}));t.auth(s[0],s.slice(1).join(":"),true)}t.proxy&&t.proxy.auth&&!t.hasHeader("proxy-authorization")&&!t.tunnel&&t.setHeader("proxy-authorization","Basic "+toBase64(t.proxy.auth.split(":").map((function(e){return U.unescape(e)})).join(":")));t.proxy&&!t.tunnel&&(t.path=t.uri.protocol+"//"+t.uri.host+t.path);if(e.json)t.json(e.json);else if(e.multipart){t.boundary=I();t.multipart(e.multipart)}if(t.body){var i=0;if(R.isBuffer(t.body))i=t.body.length;else if(Array.isArray(t.body))for(var a=0;a<t.body.length;a++)i+=t.body[a].length;else{t.body=new R(t.body);i=t.body.length}if(!i)throw new Error("Argument error, options.body.");t.hasHeader("content-length")||t.setHeader("content-length",i)}var n=t.proxy&&!t.tunnel?t.proxy.protocol:t.uri.protocol,u={"http:":x,"https:":A},h=t.httpModules||{};t.httpModule=h[n]||u[n];if(!t.httpModule)return this.emit("error",new Error("Invalid protocol"));e.ca&&(t.ca=e.ca);if(!t.agent){e.agentOptions&&(t.agentOptions=e.agentOptions);e.agentClass?t.agentClass=e.agentClass:e.forever?t.agentClass="http:"===n?Y:Y.SSL:t.agentClass=t.httpModule.Agent}if(false===t.pool)t.agent=false;else{t.agent=t.agent||t.getAgent();t.maxSockets&&(t.agent.maxSockets=t.maxSockets);t.pool.maxSockets&&(t.agent.maxSockets=t.pool.maxSockets)}t.on("pipe",(function(e){if(t.ntick&&t._started)throw new Error("You cannot pipe to this stream after the outbound request has started.");t.src=e;if(isReadStream(e))t.hasHeader("content-type")||t.setHeader("content-type",F.lookup(e.path));else{if(e.headers)for(var r in e.headers)t.hasHeader(r)||t.setHeader(r,e.headers[r]);t._json&&!t.hasHeader("content-type")&&t.setHeader("content-type","application/json");e.method&&!t.explicitMethod&&(t.method=e.method)}}));S.nextTick((function(){if(!t._aborted){if(t._form){t.setHeaders(t._form.getHeaders());t._form.pipe(t)}if(t.body){Array.isArray(t.body)?t.body.forEach((function(e){t.write(e)})):t.write(t.body);t.end()}else if(t.requestBodyStream){console.warn("options.requestBodyStream is deprecated, please pass the request object to stream.pipe.");t.requestBodyStream.pipe(t)}else if(!t.src){"GET"!==t.method&&"undefined"!==typeof t.method&&t.setHeader("content-length",0);t.end()}t.ntick=true}}))}else{var p=T.format(t.uri);var c='Invalid URI "'+p+'"';0===Object.keys(e).length&&(c+=". This can be caused by a crappy redirection.");t.emit("error",new Error(c))}};Request.prototype._updateProtocol=function(){var e=this||k;var t=e.uri.protocol;if("https:"===t){if(e.proxy&&e.canTunnel){e.tunnel=true;var r="http:"===e.proxy.protocol?J.httpsOverHttp:J.httpsOverHttps;var o={proxy:{host:e.proxy.hostname,port:+e.proxy.port,proxyAuth:e.proxy.auth},rejectUnauthorized:e.rejectUnauthorized,ca:e.ca};e.agent=r(o);return}e.httpModule=A;switch(e.agentClass){case Y:e.agentClass=Y.SSL;break;case x.Agent:e.agentClass=A.Agent;break;default:return}e.agent&&(e.agent=e.getAgent())}else{e.tunnel&&(e.tunnel=false);e.httpModule=x;switch(e.agentClass){case Y.SSL:e.agentClass=Y;break;case A.Agent:e.agentClass=x.Agent;break;default:return}if(e.agent){e.agent=null;e.agent=e.getAgent()}}};Request.prototype.getAgent=function(){var e=(this||k).agentClass;var t={};if((this||k).agentOptions)for(var r in(this||k).agentOptions)t[r]=(this||k).agentOptions[r];(this||k).ca&&(t.ca=(this||k).ca);(this||k).ciphers&&(t.ciphers=(this||k).ciphers);(this||k).secureProtocol&&(t.secureProtocol=(this||k).secureProtocol);"undefined"!==typeof(this||k).rejectUnauthorized&&(t.rejectUnauthorized=(this||k).rejectUnauthorized);if((this||k).cert&&(this||k).key){t.key=(this||k).key;t.cert=(this||k).cert}var o="";e!==(this||k).httpModule.Agent&&(o+=e.name);if(!(this||k).httpModule.globalAgent){t.host=(this||k).host;t.port=(this||k).port;o&&(o+=":");o+=(this||k).host+":"+(this||k).port}var s=(this||k).proxy;"string"===typeof s&&(s=T.parse(s));var i=s&&"https:"===s.protocol||"https:"===(this||k).uri.protocol;if(i){if(t.ca){o&&(o+=":");o+=t.ca}if("undefined"!==typeof t.rejectUnauthorized){o&&(o+=":");o+=t.rejectUnauthorized}t.cert&&(o+=t.cert.toString("ascii")+t.key.toString("ascii"));if(t.ciphers){o&&(o+=":");o+=t.ciphers}if(t.secureProtocol){o&&(o+=":");o+=t.secureProtocol}}if((this||k).pool===ee&&!o&&0===Object.keys(t).length&&(this||k).httpModule.globalAgent)return(this||k).httpModule.globalAgent;o=(this||k).uri.protocol+o;return(this||k).pool[o]?(this||k).pool[o]:(this||k).pool[o]=new e(t)};Request.prototype.start=function(){var e=this||k;if(!e._aborted){e._started=true;e.method=e.method||"GET";e.href=e.uri.href;e.src&&e.src.stat&&e.src.stat.size&&!e.hasHeader("content-length")&&e.setHeader("content-length",e.src.stat.size);e._aws&&e.aws(e._aws,true);var t=W(e);delete t.auth;X("make request",e.uri.href);e.req=e.httpModule.request(t,e.onResponse.bind(e));if(e.timeout&&!e.timeoutTimer){e.timeoutTimer=setTimeout((function(){e.req.abort();var t=new Error("ETIMEDOUT");t.code="ETIMEDOUT";e.emit("error",t)}),e.timeout);e.req.setTimeout&&e.req.setTimeout(e.timeout,(function(){if(e.req){e.req.abort();var t=new Error("ESOCKETTIMEDOUT");t.code="ESOCKETTIMEDOUT";e.emit("error",t)}}))}e.req.on("error",e.clientErrorHandler);e.req.on("drain",(function(){e.emit("drain")}));e.on("end",(function(){e.req.connection&&e.req.connection.removeListener("error",e._parserErrorHandler)}));e.emit("request",e.req)}};Request.prototype.onResponse=function(e){var t=this||k;X("onResponse",t.uri.href,e.statusCode,e.headers);e.on("end",(function(){X("response end",t.uri.href,e.statusCode,e.headers)}));-1===e.connection.listeners("error").indexOf(t._parserErrorHandler)&&e.connection.once("error",t._parserErrorHandler);if(t._aborted){X("aborted",t.uri.href);e.resume()}else{t._paused?e.pause():e.resume();t.response=e;e.request=t;e.toJSON=toJSON;if(t.httpModule!==A||!t.strictSSL||e.client.authorized){t.setHost&&t.hasHeader("host")&&delete t.headers[t.hasHeader("host")];if(t.timeout&&t.timeoutTimer){clearTimeout(t.timeoutTimer);t.timeoutTimer=null}var addCookie=function(e){if(t._jar){var r=t._jar.setCookie?t._jar:V;r.setCookie(e,t.uri.href,(function(e){e&&console.warn("set cookie failed,"+e)}))}};if(re("set-cookie",e.headers)&&!t._disableCookies){var r=re("set-cookie",e.headers);Array.isArray(e.headers[r])?e.headers[r].forEach(addCookie):addCookie(e.headers[r])}var o=null;if(e.statusCode>=300&&e.statusCode<400&&re("location",e.headers)){var s=e.headers[re("location",e.headers)];X("redirect",s);if(t.followAllRedirects)o=s;else if(t.followRedirect)switch(t.method){case"PATCH":case"PUT":case"POST":case"DELETE":break;default:o=s;break}}else if(401==e.statusCode&&t._hasAuth&&!t._sentAuth){var i=e.headers[re("www-authenticate",e.headers)];var a=i&&i.split(" ")[0];X("reauth",a);switch(a){case"Basic":t.auth(t._user,t._pass,true);o=t.uri;break;case"Digest":var n={};var u=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){var h=u.exec(i);if(!h)break;n[h[1]]=h[2]||h[3]}var p=md5(t._user+":"+n.realm+":"+t._pass);var c=md5(t.method+":"+t.uri.path);var l=/(^|,)\s*auth\s*($|,)/.test(n.qop)&&"auth";var f=l&&"00000001";var m=l&&I().replace(/-/g,"");var y=md5(l?p+":"+n.nonce+":"+f+":"+m+":"+l+":"+c:p+":"+n.nonce+":"+c);var g={username:t._user,realm:n.realm,nonce:n.nonce,uri:t.uri.path,qop:l,response:y,nc:f,cnonce:m,algorithm:n.algorithm,opaque:n.opaque};i=[];for(var v in g)g[v]&&("qop"===v||"nc"===v||"algorithm"===v?i.push(v+"="+g[v]):i.push(v+'="'+g[v]+'"'));i="Digest "+i.join(", ");t.setHeader("authorization",i);t._sentAuth=true;o=t.uri;break}}if(o){X("redirect to",o);t._paused&&e.resume();if(t._redirectsFollowed>=t.maxRedirects){t.emit("error",new Error("Exceeded maxRedirects. Probably stuck in a redirect loop "+t.uri.href));return}t._redirectsFollowed+=1;te.test(o)||(o=T.resolve(t.uri.href,o));var b=t.uri;t.uri=T.parse(o);t.uri.protocol!==b.protocol&&t._updateProtocol();t.redirects.push({statusCode:e.statusCode,redirectUri:o});t.followAllRedirects&&401!=e.statusCode&&(t.method="GET");delete t.src;delete t.req;delete t.agent;delete t._started;if(401!=e.statusCode){delete t.body;delete t._form;if(t.headers){t.hasHeader("host")&&delete t.headers[t.hasHeader("host")];t.hasHeader("content-type")&&delete t.headers[t.hasHeader("content-type")];t.hasHeader("content-length")&&delete t.headers[t.hasHeader("content-length")]}}t.emit("redirect");t.init()}else{t._redirectsFollowed=t._redirectsFollowed||0;e.on("close",(function(){t._ended||t.response.emit("end")}));t.encoding&&(0!==t.dests.length?console.error("Ignoring encoding parameter as this stream is being piped to another stream which makes the encoding option invalid."):e.setEncoding(t.encoding));t.emit("response",e);t.dests.forEach((function(e){t.pipeDest(e)}));e.on("data",(function(e){t._destdata=true;t.emit("data",e)}));e.on("end",(function(e){t._ended=true;t.emit("end",e)}));e.on("close",(function(){t.emit("close")}));if(t.callback){var q=[];var _=0;t.on("data",(function(e){q.push(e);_+=e.length}));t.on("end",(function(){X("end event",t.uri.href);if(t._aborted)X("aborted",t.uri.href);else{if(q.length&&R.isBuffer(q[0])){X("has body",t.uri.href,_);var r=new R(_);var o=0;q.forEach((function(e){e.copy(r,o,0,e.length);o+=e.length}));null===t.encoding?e.body=r:e.body=r.toString(t.encoding)}else if(q.length){"utf8"===t.encoding&&q[0].length>0&&"\ufeff"===q[0][0]&&(q[0]=q[0].substring(1));e.body=q.join("")}if(t._json)try{e.body=JSON.parse(e.body)}catch(e){}X("emitting complete",t.uri.href);void 0!=e.body||t._json||(e.body="");t.emit("complete",e,e.body)}}))}else t.on("end",(function(){t._aborted?X("aborted",t.uri.href):t.emit("complete",e)}));X("finish init function",t.uri.href)}}else{X("strict ssl error",t.uri.href);var w=e.client.authorizationError;t.emit("error",new Error("SSL Error: "+w))}}};Request.prototype.abort=function(){(this||k)._aborted=true;(this||k).req?(this||k).req.abort():(this||k).response&&(this||k).response.abort();this.emit("abort")};Request.prototype.pipeDest=function(e){var t=(this||k).response;if(e.headers&&!e.headersSent){if(re("content-type",t.headers)){var r=re("content-type",t.headers);e.setHeader?e.setHeader(r,t.headers[r]):e.headers[r]=t.headers[r]}if(re("content-length",t.headers)){var o=re("content-length",t.headers);e.setHeader?e.setHeader(o,t.headers[o]):e.headers[o]=t.headers[o]}}if(e.setHeader&&!e.headersSent){for(var s in t.headers)e.setHeader(s,t.headers[s]);e.statusCode=t.statusCode}(this||k).pipefilter&&this.pipefilter(t,e)};Request.prototype.setHeader=function(e,t,r){void 0===r&&(r=true);r||!this.hasHeader(e)?(this||k).headers[e]=t:(this||k).headers[this.hasHeader(e)]+=","+t;return this||k};Request.prototype.setHeaders=function(e){for(var t in e)this.setHeader(t,e[t]);return this||k};Request.prototype.hasHeader=function(e,t){var t=Object.keys(t||(this||k).headers),r=t.map((function(e){return e.toLowerCase()}));e=e.toLowerCase();for(var o=0;o<r.length;o++)if(r[o]===e)return t[o];return false};var re=Request.prototype.hasHeader;Request.prototype.qs=function(e,t){var r;r=!t&&(this||k).uri.query?P.parse((this||k).uri.query):{};for(var o in e)r[o]=e[o];if(""===P.stringify(r))return this||k;(this||k).uri=T.parse((this||k).uri.href.split("?")[0]+"?"+P.stringify(r));(this||k).url=(this||k).uri;(this||k).path=(this||k).uri.path;return this||k};Request.prototype.form=function(e){if(e){this.setHeader("content-type","application/x-www-form-urlencoded; charset=utf-8");(this||k).body=P.stringify(e).toString("utf8");return this||k}(this||k)._form=new K;return(this||k)._form};Request.prototype.multipart=function(e){var t=this||k;t.body=[];if(t.hasHeader("content-type")){var r=t.hasHeader("content-type");t.setHeader(r,t.headers[r].split(";")[0]+"; boundary="+t.boundary)}else t.setHeader("content-type","multipart/related; boundary="+t.boundary);if(!e.forEach)throw new Error("Argument error, options.multipart.");t.preambleCRLF&&t.body.push(new R("\r\n"));e.forEach((function(e){var r=e.body;if(null==r)throw Error("Body attribute missing in multipart.");delete e.body;var o="--"+t.boundary+"\r\n";Object.keys(e).forEach((function(t){o+=t+": "+e[t]+"\r\n"}));o+="\r\n";t.body.push(new R(o));t.body.push(new R(r));t.body.push(new R("\r\n"))}));t.body.push(new R("--"+t.boundary+"--"));return t};Request.prototype.json=function(e){var t=this||k;t.hasHeader("accept")||t.setHeader("accept","application/json");(this||k)._json=true;if("boolean"===typeof e){if("object"===typeof(this||k).body){(this||k).body=safeStringify((this||k).body);t.setHeader("content-type","application/json")}}else{(this||k).body=safeStringify(e);t.setHeader("content-type","application/json")}return this||k};Request.prototype.getHeader=function(e,t){var r,o,s;t||(t=(this||k).headers);Object.keys(t).forEach((function(i){o=new RegExp(e,"i");s=i.match(o);s&&(r=t[i])}));return r};var oe=Request.prototype.getHeader;Request.prototype.auth=function(e,t,r){if("string"!==typeof e||void 0!==t&&"string"!==typeof t)throw new Error("auth() received invalid user or password");(this||k)._user=e;(this||k)._pass=t;(this||k)._hasAuth=true;var o="undefined"!==typeof t?e+":"+t:e;if(r||"undefined"==typeof r){this.setHeader("authorization","Basic "+toBase64(o));(this||k)._sentAuth=true}return this||k};Request.prototype.aws=function(e,t){if(!t){(this||k)._aws=e;return this||k}var r=new Date;this.setHeader("date",r.toUTCString());var o={key:e.key,secret:e.secret,verb:(this||k).method.toUpperCase(),date:r,contentType:this.getHeader("content-type")||"",md5:this.getHeader("content-md5")||"",amazonHeaders:B.canonicalizeHeaders((this||k).headers)};e.bucket&&(this||k).path?o.resource="/"+e.bucket+(this||k).path:e.bucket&&!(this||k).path?o.resource="/"+e.bucket:!e.bucket&&(this||k).path?o.resource=(this||k).path:e.bucket||(this||k).path||(o.resource="/");o.resource=B.canonicalizeResource(o.resource);this.setHeader("authorization",B.authorization(o));return this||k};Request.prototype.httpSignature=function(e){var t=this||k;L.signRequest({getHeader:function(e){return oe(e,t.headers)},setHeader:function(e,r){t.setHeader(e,r)},method:(this||k).method,path:(this||k).path},e);X("httpSignature authorization",this.getHeader("authorization"));return this||k};Request.prototype.hawk=function(e){this.setHeader("Authorization",N.client.header((this||k).uri,(this||k).method,e).field)};Request.prototype.oauth=function(e){var t;this.hasHeader("content-type")&&"application/x-www-form-urlencoded"===this.getHeader("content-type").slice(0,"application/x-www-form-urlencoded".length)&&(t=P.parse((this||k).body));(this||k).uri.query&&(t=P.parse((this||k).uri.query));t||(t={});var r={};for(var o in t)r[o]=t[o];for(var o in e)r["oauth_"+o]=e[o];r.oauth_version||(r.oauth_version="1.0");r.oauth_timestamp||(r.oauth_timestamp=Math.floor(Date.now()/1e3).toString());r.oauth_nonce||(r.oauth_nonce=I().replace(/-/g,""));r.oauth_signature_method="HMAC-SHA1";var s=r.oauth_consumer_secret;delete r.oauth_consumer_secret;var i=r.oauth_token_secret;delete r.oauth_token_secret;var a=r.oauth_timestamp;var n=(this||k).uri.protocol+"//"+(this||k).uri.host+(this||k).uri.pathname;var u=M.hmacsign((this||k).method,n,r,s,i);for(var o in t)if(o.slice(0,"oauth_")in e);else{delete r["oauth_"+o];"x_auth_mode"!==o&&delete r[o]}r.oauth_timestamp=a;var h="OAuth "+Object.keys(r).sort().map((function(e){return e+'="'+M.rfc3986(r[e])+'"'})).join(",");h+=',oauth_signature="'+M.rfc3986(u)+'"';this.setHeader("Authorization",h);return this||k};Request.prototype.jar=function(e){var t;0===(this||k)._redirectsFollowed&&((this||k).originalCookieHeader=this.getHeader("cookie"));if(e){var r=e&&e.getCookieString?e:V;var o=(this||k).uri.href;r.getCookieString(o,(function(e,r){e?console.warn("get cookieString failed,"+e):t=r}))}else{t=false;(this||k)._disableCookies=true}t&&t.length&&((this||k).originalCookieHeader?this.setHeader("cookie",(this||k).originalCookieHeader+"; "+t):this.setHeader("cookie",t));(this||k)._jar=e;return this||k};Request.prototype.pipe=function(e,t){if((this||k).response){if((this||k)._destdata)throw new Error("You cannot pipe after data has been emitted from the response.");if((this||k)._ended)throw new Error("You cannot pipe after the response has been ended.");z.Stream.prototype.pipe.call(this||k,e,t);this.pipeDest(e);return e}(this||k).dests.push(e);z.Stream.prototype.pipe.call(this||k,e,t);return e};Request.prototype.write=function(){(this||k)._started||this.start();return(this||k).req.write.apply((this||k).req,arguments)};Request.prototype.end=function(e){e&&this.write(e);(this||k)._started||this.start();(this||k).req.end()};Request.prototype.pause=function(){(this||k).response?(this||k).response.pause.apply((this||k).response,arguments):(this||k)._paused=true};Request.prototype.resume=function(){(this||k).response?(this||k).response.resume.apply((this||k).response,arguments):(this||k)._paused=false};Request.prototype.destroy=function(){(this||k)._ended?(this||k).response&&(this||k).response.destroy():this.end()};function toJSON(){return Z(this||k,"__"+(65536*(1+Math.random())|0).toString(16))}Request.prototype.toJSON=toJSON;E=Request;var se=E;var ie={};var ae=c;var ne=m,ue=ne("tough-cookie"),he=ue&&ue.Cookie,pe=ue&&ue.CookieJar,ce=pe&&new pe,de=g,le=se;function initParams(e,t,r){"function"!==typeof t||r||(r=t);if(t&&"object"===typeof t)t.uri=e;else if("string"===typeof e)t={uri:e};else{t=e;e=t.uri}return{uri:e,options:t,callback:r}}function request(e,t,r){if("undefined"===typeof e)throw new Error("undefined is not a valid uri or options object.");"function"!==typeof t||r||(r=t);t&&"object"===typeof t?t.uri=e:t="string"===typeof e?{uri:e}:e;t=de(t);r&&(t.callback=r);var o=new le(t);return o}ie=request;request.Request=le;request.debug=ae.env.NODE_DEBUG&&/request/.test(ae.env.NODE_DEBUG);request.initParams=initParams;request.defaults=function(e,t){var def=function(r){var d=function(o,s,i){var a=initParams(o,s,i);for(var n in e)void 0===a.options[n]&&(a.options[n]=e[n]);"function"===typeof t&&(r===request?r=t:a.options._requester=t);return r(a.options,a.callback)};return d};var r=def(request);r.get=def(request.get);r.patch=def(request.patch);r.post=def(request.post);r.put=def(request.put);r.head=def(request.head);r.del=def(request.del);r.cookie=def(request.cookie);r.jar=request.jar;return r};function requester(e){return"function"===typeof e.options._requester?e.options._requester:request}request.forever=function(e,t){var r={};if(t)for(var o in t)r[o]=t[o];e&&(r.agentOptions=e);r.forever=true;return request.defaults(r)};request.get=request;request.post=function(e,t,r){var o=initParams(e,t,r);o.options.method="POST";return requester(o)(o.uri||null,o.options,o.callback)};request.put=function(e,t,r){var o=initParams(e,t,r);o.options.method="PUT";return requester(o)(o.uri||null,o.options,o.callback)};request.patch=function(e,t,r){var o=initParams(e,t,r);o.options.method="PATCH";return requester(o)(o.uri||null,o.options,o.callback)};request.head=function(e,t,r){var o=initParams(e,t,r);o.options.method="HEAD";if(o.options.body||o.options.requestBodyStream||o.options.json&&"boolean"!==typeof o.options.json||o.options.multipart)throw new Error("HTTP HEAD requests MUST NOT include a request body.");return requester(o)(o.uri||null,o.options,o.callback)};request.del=function(e,t,r){var o=initParams(e,t,r);o.options.method="DELETE";return requester(o)(o.uri||null,o.options,o.callback)};request.jar=function(){return new pe};request.cookie=function(e){e&&e.uri&&(e=e.uri);if("string"!==typeof e)throw new Error("The cookie function only accepts STRING as param");return new he(e)};var fe=ie;export default fe;

